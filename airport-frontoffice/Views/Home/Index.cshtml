@{
    ViewData["Title"] = "Home Page";
}

<div>
    <div id="search-block" class="row justify-content-md-center">
        <div class="col-8 my-2">
            <form id="search-form">
                <div class="row">
                    <div class="row col mb-1">
                        <input class="col mx-1 form-control" id="Depart" placeholder="Départ" />
                        <input class="col mx-1 form-control" id="Depart-value" hidden/>
                        <div class="col-1 text-center text-white pt-1">
                            <i class="bi bi-arrow-left-right"></i>
                        </div>
                        <input class="col mx-1 form-control" id="Destination" placeholder="Déstination" />
                        <input class="col mx-1 form-control" id="Destination-value" hidden />
                    </div>
                    <div class="row col mb-1">
                        <input class="col mx-1 form-control" id="Date-depart" type="datetime-local" placeholder="Déstination">
                    </div>
                    <input type="submit" id="searchButton" value="Rechercher">
                </div>
            </form>
        </div>
    </div>

    <div id="result-block" class="container p-3 mt-2">
        
    </div>
</div>

<script>
    document.getElementById("search-form").addEventListener('submit',  function(event) {
        event.preventDefault();
        var depart = document.getElementById('Depart-value').value;
        var arrive = document.getElementById('Destination-value').value;
        var dateDepart = document.getElementById('Date-depart').value;
        var url = `/Home/RechercheVol?depart=${encodeURIComponent(depart)}&arrive=${encodeURIComponent(arrive)}&date=${encodeURIComponent(dateDepart)}`
        console.log(url);
        fetch(url)
            .then(response => response.text())
            .then(html => {
                document.getElementById('result-block').innerHTML = html;
            })
            .catch(error => console.error('Error:', error));
    });

    $("#Depart").autocomplete({
        source: function (request, response) {
            // console.log(request.term);
             $.ajax({
                // Your API URL
                url: "/api/Airport/Airports",
                dataType: "json", // Assuming your API returns JSON
                data: {
                    // Pass user input as the 'ville' parameter
                    ville: request.term,
                },
                success: function (data) {
                    // response( data.map( item => item.Ville ) );
                    response(data.map(function (item) {
                        return {
                            label: item.Ville,
                            value: item.AirportId
                        };
                    }));
                    // Map the response to a format usable by autocomplete
                    // response(data);
                },
                error: function (xhr, status, error) {
                    console.error("Error fetching autocomplete data: ", error);
                    response([]); // Return an empty array on error
                }
            });
        },
        select: function (event, ui) {
            $("#Depart").val(ui.item.label);
            $("#Depart-value").val(ui.item.value);
            event.preventDefault();
        },
    });
    $("#Destination").autocomplete({
        source: function (request, response) {
             $.ajax({
                url: "/api/Airport/Airports",
                dataType: "json",
                data: {
                    ville: request.term,
                },
                success: function (data) {
                    response(data.map(function (item) {
                        return {
                            label: item.Ville,
                            value: item.AirportId
                        };
                    }));
                },
                error: function (xhr, status, error) {
                    console.error("Error fetching autocomplete data: ", error);
                    response([]);
                }
            });
        },
        select: function (event, ui) {
            $("#Destination").val(ui.item.label);
            $("#Destination-value").val(ui.item.value);
            event.preventDefault();
        },
    });
</script>